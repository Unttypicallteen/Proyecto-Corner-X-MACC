import dash
from dash import dcc, html
from dash.dependencies import Input, Output, State
import psycopg2

# Conexión a la base de datos
conn = psycopg2.connect(
    dbname="Proyecto Corner",
    user="postgres",
    password="123456789",
    host="localhost",  # Cambia esto si tu base de datos está en otro servidor
    port="5432"
)
cursor = conn.cursor()

# Creación de la aplicación Dash
app = dash.Dash(__name__)

# Diseño de la interfaz de usuario
app.layout = html.Div([
    html.H1("Insertar Datos en la Base de Datos"),
    
    html.Label("ID:"),
    dcc.Input(id='input-ID', type='text', value=''),

    html.Label("Nombre:"),
    dcc.Input(id='input-nombre', type='text', value=''),

    html.Label("Placa Vehículo:"),
    dcc.Input(id='input-placa', type='text', value=''),

    html.Button('Insertar', id='submit-button', n_clicks=0),

    html.Div(id='output-message')
])

# Callback para insertar datos en la base de datos
@app.callback(
    Output('output-message', 'children'),
    Input('submit-button', 'n_clicks'),
    State('input-ID', 'value'),
    State('input-nombre', 'value'),
    State('input-placa', 'value')
)
def insertar_datos(n_clicks, ID, nombre, placa):
    if n_clicks > 0:
        # Consulta SQL de inserción
        insert_query = """
        INSERT INTO conductor (ID, nombre, Placa_Vehiculo)
        VALUES (%s, %s, %s);
        """
        try:
            cursor.execute(insert_query, (ID, nombre, placa))
            conn.commit()
            return f"Datos insertados correctamente en la base de datos. El usuario con ID {ID} y nombre {nombre} registró el vehículo con placa {placa}."
        except Exception as e:
            conn.rollback()
            return f"Error al insertar datos: {str(e)}"
    return "Introduce los datos y haz clic en Insertar."

# Ejecutar la aplicación
if __name__ == '__main__':
    app.run_server(debug=True)
